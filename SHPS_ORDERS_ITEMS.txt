//select * from orders_items_report_new;

CREATE OR REPLACE VIEW EDP_NP.CRT_SHPS.DAILY_ORDERS_ITEMS_REPORT AS 

WITH U AS (
    SELECT ORDERID, ORDERITEMID, MAX(MODIFYDATE) AS MAX_MODIFYDATE FROM  EDP_NP.LND_SHPS.ORDERS_ITEMS_REPORT_NEW 
    GROUP BY ORDERID, ORDERITEMID
),

BASE AS (
    SELECT * FROM EDP_NP.LND_SHPS.ORDERS_ITEMS_REPORT_NEW
),

MAIN AS (
    SELECT BASE.*, U.MAX_MODIFYDATE, ROW_NUMBER() OVER (PARTITION BY U.ORDERID, U.ORDERITEMID ORDER BY U.MAX_MODIFYDATE DESC) AS row_num
    FROM BASE
    LEFT JOIN U
    ON BASE.ORDERID = U.ORDERID AND BASE.ORDERITEMID = U.ORDERITEMID
)

SELECT * FROM MAIN
WHERE ROW_NUM = 1;
